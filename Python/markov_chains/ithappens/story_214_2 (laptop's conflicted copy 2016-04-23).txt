
Поведаю-ка леденящую душу историю. Случилась она года три назад. Работал я тогда в провайдере админом, обеспечивая биллинг и шейпинг. Начиная с какого-то времени из техподдержки стали приходить одинаковые заявки: пользователи жаловались на огромные задержки при работе по HTTP, при этом другие протоколы работали отлично. Поначалу это меня не касалось, но тут пришли админы с роутеров и сказали, что у них всё чисто, а режет всё это дело мой шейпер.Полез разбираться. На нашем оборудовании проблема не воспроизводилась совсем — заход с логином пользователя на этот же шейпер давал полноценный интернет. За безуспешными попытками прошла неделя, по прошествии которой путём вдумчивого изучения «нетстата» я вдруг обнаружил, что проблема проявляется только у клиентов, у которых стоит линукс. Я быстро проверил свою теорию — так и было. Поразбиравшись ещё немного, я выяснил, что запросы по HTTP от линукса и винды ходят в биллинге по разным маршрутам. Это удивило меня окончательно, и я пошёл копать дальше.Ещё до меня, в начале «нулевых» работал на сетке безопасник. Отличался он крайне нездоровым характером и твёрдой уверенностью в том, что любой линуксоид — это хакер, а значит, за ним надо следить с особой тщательностью. Недолго думая, поставил он на сервере программу, которая выборочно анализировала HTTP-заголовки и, найдя строчку «Linux» в User-Agent, перенаправляла все запросы пользователя на специальный сервер с логами. Проблема же возникла только три месяца назад, потому что линуксоидов в городе стало слишком много, и сервер, ведущий логи, перестал справляться со своей работой и начал тормозить пакеты.


